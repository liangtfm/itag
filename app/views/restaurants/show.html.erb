<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1vzTzS0JGhNkO2rWAopHhtIrFZBImTZ4&sensor=false">
</script>

<script>
function initialize() {
  var address = $('#address').html();
  var geocoder = new google.maps.Geocoder();

  geocoder.geocode({address: address}, function(results, status) {
    var mapOptions = {
      center: new google.maps.LatLng(results[0].geometry.location['e'], results[0].geometry.location['d']),
      zoom: 16
    };

    var marker = new google.maps.Marker({
        map: map,
        position: results[0].geometry.location
    });

    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

    map.setCenter(results[0].geometry.location);
    var marker = new google.maps.Marker({
      map: map,
      position: results[0].geometry.location
    });

  });
};

google.maps.event.addDomListener(window, 'load', initialize);
</script>


<div class="rest-content group">

  <div class="rest-left group">
    <div class="rest-info">

      <div class="rest-photo">
      <% if @restaurant.photo.file? %>
        <%= image_tag @restaurant.photo.url(:big) %>
      <% end %>
      </div>


    <h2>
      <%= @restaurant.name %>
      <%= "(CLOSED)" if @restaurant.open == false %>
    </h2>

    <% if current_user && current_user.admin == true %>
      (<%= link_to "Edit Listing", edit_restaurant_url(@restaurant) %>)
    <% end %>
    <br>

  <% if current_user.favorite_places.include?(@restaurant) %>
    <%= button_to "UNFAVORITE", restaurant_favorite_url(@restaurant), method: :delete, form_class: "favorite-button grad_button" %>
  <% else %>
    <%= button_to "FAVORITE", restaurant_favorites_url(@restaurant), method: :post, form_class: "favorite-button grad_button" %>
  <% end %>

  <br>

  Average Rating: <%= @restaurant.average_rating %> (<%= @restaurant.reviews.count %> reviews)

  <br>

  Categories:
  <br>
  <ul>
  <% @restaurant.categories.each do |category| %>
    <li><%= category.name %></li>
  <% end %>
  </ul>

  <!-- RESTAURANT INFO -->

  <h3>Restaurant Info</h3>
  <ul>
    <% unless @restaurant.website.empty? %>
      <li><%= link_to @restaurant.website, @restaurant.website %> </li>
    <% end %>
    <% unless @restaurant.phone.empty? %>
      <li> <%= @restaurant.phone %> </li>
    <% end %>
    <% unless @restaurant.price.nil? %>
      <li> <%= @restaurant.price %> </li>
    <% end %>
    <li id="address"><%= @restaurant.street %>, <%= @restaurant.city.name %>, <%= @restaurant.state.name %></li>
    <% unless @restaurant.zip.empty? %>
      <%= @restaurant.zip %>
    <% end %>
  </ul>

  <!-- REVIEWS -->

  <h3>Reviews</h3>

  <% if current_user && @restaurant.open == true %>
    <%= link_to "Write a review!", new_restaurant_review_url(@restaurant) %>
  <% end %>

  <br>

  <%= render "reviews/index", :restaurant => @restaurant %>

    </div>
  </div>


  <!-- MAPS IMAGE -->

  <div class="rest-right group">

    <div id="map-canvas">

    </div>

  </div>

</div>